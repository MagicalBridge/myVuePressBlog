---
sidebar: auto
---

# CI/CD

## 什么是CI/CD

在开发阶段，许多编译工具会将我们的源码编译成可使用的文件。例如 `vue-cli`的项目被 `webpack`打包编译为浏览器可识别的文件，`Java` 项目会被编译为 `.class/jar`文件以供服务器使用。

但是开发人员过多关注构建和部署过程是很浪费时间的。以之前古老的构建部署流程为例，需要经历以下步骤：
- 1.开发人员将源代码，经过编译、压缩等一系列流程打包为制品（打包后的成品）。
- 2.将打包好的文件传到服务器
- 3.在服务器将编译后的文件，手动移动到可用的容器服务内（例如 `Nginx Tomcat Apache`等服务）

![流程](./../images/cicd/01.png)

显而易见，这种流程不仅繁琐，且容易出错，是非常影响开发效率的。开发人员要花一些时间浪费在这上面，有没有提高效率，简单便捷一些方式呢？

这就要提到`CI/CD`了。 `CI`的意思是`持续构建`。负责拉取代码库中的代码后，执行用户预置定义好的操作脚本，通过一系列编译操作构建出一个 `制品`，并将制品推送到制品库里面，常用的工具有Gitlab CI, Github CI, Jenkins等，这个环节不参与部署，只负责构建代码，然后保存构建物。构建物被称作制品，保存制品的地方被称为"制品库"

CD则有两层含义：`持续部署(Continuous Deployment)` 和 `持续交付(Continuous Delivery)`。 `持续交付`的概念是：将制品库的制品拿出后，部署在测试环境/交付给客户提前测试。`持续部署`则是将制品部署在生产环境，可以进行持续部署的工具也有很多：`Ansible`批量部署，`Docker`直接推拉镜像等等。当然也包括我们后面写道的 `Kubernetes` 集群部署。

## 整体完成之后
- 1.写完了代码，提交到了`Git`代码仓库。
- 2.随后，代码仓库配置的 `WebHook` 钩子或者人工启动了 `JenKins` 的构建流程。
- 3.Jenkins 启动构建流程。按照你之前配置好的构建脚本，将代码编译成功。
- 4.编译成功后，将编译后的文件打包为 docker 镜像，并将镜像上传到私有镜像仓库。
- 5.随后，使用 kubectl 指定远程的k8s集群，发送镜像版本更新指令
- 6.远程的k8s集群接收到指令后，去镜像库拉取新镜像
- 7.镜像拉取成功，按照升级策略（滚动升级）进行升级，此时不会停机。
- 8.升级完毕。

